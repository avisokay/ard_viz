---
title: " "
author: " "
date: ' '
output:
  html_document
runtime: shiny
---

```{r include=FALSE}
library(visNetwork)
library(igraph)
library(r2d3)
library(kableExtra)
library(dplyr)
library(shiny)
library(shinythemes)
library(DT)
```

<br>

# Consistently estimating network statistics using Aggregated Relational Data (***ARD***)
The full paper can be found [here](https://arxiv.org/abs/1908.09881).

<br>

### Collecting complete network data is expensive, time-consuming, and often infeasible. 

### ***ARD*** captures network information by asking a respondent questions of the form:

<br>

<center> <font size="5">  ***How many people with trait X do you know?*** </font>  </center>

<br>

### How can we use this relatively low-cost data to estimate features of the complete network when it cannot be directly observed?

### Here's an example of how it works.

<br>

# 1. Gather some Aggregated Relational Data

### First, let $G$ represent an unobserved network with 10 nodes and 3 groups. 

### Assume we are in a setting where we only have access to a few nodes.

<br>

<center> <font size="5">  ***Click on a node to see its neighbors!*** </font>  </center>

```{r, echo=FALSE}

#dataset
nodes = data.frame(id = 1:10,
                  label = as.character(1:10),
                  shape = "circle",
                  font.size = 30,
                  align = "center",
                  group = c(rep("Grey", 3), 
                            rep("Red", 3), 
                            rep("Gold", 4)),
                  borderWidth = 2,
                  color.background = c(rep("slategrey", 3), 
                                       rep("tomato", 3), 
                                       rep("gold", 4)),
                  color.border = "black",
                  color.highlight.background = "green", 
                  color.highlight.border = "black",
                  shadow = TRUE
                  # title = paste0("</b>Node </p>", 1:10)
)

edges = data.frame(from = c(1, 1, 2, 3, 4, 4, 5, 6, 7, 8, 8, 9, 9, 10, 10), 
                  to   = c(2, 3, 3, 5, 5, 6, 6, 7, 8, 9, 10, 10, 1, 7, 3))

# how many each node knows data
ARD = data.frame(rbind(c(1, 2, 0, 1),
                       c(2, 2, 0, 0),
                       c(3, 2, 1, 1),
                       c(4, 0, 2, 0),
                       c(5, 1, 2, 0),
                       c(6, 0, 2, 1),
                       c(7, 0, 1, 2),
                       c(8, 0, 0, 3),
                       c(9, 1, 0, 2),
                       c(10, 1, 0, 3)))
colnames(ARD) = c("Node", "Grey", "Red", "Gold")

ui = fluidPage(
  visNetworkOutput("network_proxy", height = "600px"),
  dataTableOutput("nodes_data_from_shiny")
)

server = function(input, output, session) {

  # highlight selected node and contacts
  output$network_proxy = renderVisNetwork({
    visNetwork(nodes, edges) %>%
      visOptions(highlightNearest=TRUE) %>%
      
      visEvents(select = "function(nodes) {
                Shiny.onInputChange('current_node_id', nodes.nodes);
                ;}")
  })
  
  # display output from ARD table based on node selection
  output$nodes_data_from_shiny = renderDT({
    info = data.frame(ARD)
    
    info[ARD$Node == input$current_node_id, ]
  }, 
  
  # only display table, not search or page toggle
  options = list(dom = 't'),
  rownames = FALSE)

}

shinyApp(ui, server, options = list(height = 725))
```

### As you can see, ***node 4*** has only two contacts and they are both in the *Red* group while ***node 3*** knows two in the *Grey* group, and one each in *Red* and *Gold*. 

<br>

```{r, echo = FALSE}
ARD %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```


### To da!




